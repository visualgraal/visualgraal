<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Visualgraal – See the invisible</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:system-ui,sans-serif;background:#f5f7fa;color:#4a5568;height:100vh;display:flex;flex-direction:column;overflow:hidden;}
header{background:#fff;border-bottom:1px solid #e2e8f0;padding:12px 20px;display:flex;justify-content:space-between;align-items:center;}
#logo{display:flex;align-items:center;gap:8px;}
#logo img{width:24px;height:24px;}
#logo-text{font-size:22px;font-weight:700;color:#4a5568;}
select{padding:8px 12px;border:1px solid #e2e8f0;border-radius:6px;background:#fff;color:#4a5568;font-size:14px;cursor:pointer;}
#prompt-section{padding:16px;background:#fff;border-bottom:1px solid #e2e8f0;}
#prompt{width:100%;padding:12px;border:1px solid #e2e8f0;border-radius:8px;font-size:16px;resize:none;height:60px;}
#generate{width:100%;padding:12px;background:#4a5568;color:#fff;border:none;border-radius:8px;font-size:16px;font-weight:600;cursor:pointer;margin-top:8px;}
#generate:hover{background:#2d3748;}
#generate:disabled{background:#a0aec0;cursor:not-allowed;}
#canvas-area{flex:1;display:flex;justify-content:center;align-items:center;background:#f7fafc;padding:20px;overflow:auto;}
#canvas{border:1px solid #e2e8f0;border-radius:12px;background:#fff;cursor:crosshair;max-width:100%;max-height:100%;touch-action:none;}
#tools{padding:16px;padding-bottom:env(safe-area-inset-bottom,60px);background:#fff;border-top:1px solid #e2e8f0;display:flex;gap:12px;justify-content:center;flex-wrap:wrap;min-height:80px;z-index:10;}
.tool-btn{padding:12px 20px;background:#e2e8f0;color:#4a5568;border:none;border-radius:8px;cursor:pointer;font-size:14px;font-weight:500;min-height:44px;min-width:100px;flex:1;max-width:150px;}
.tool-btn.active{background:#4a5568;color:#fff;}
#status{padding:12px;background:#fff;border-top:1px solid #e2e8f0;display:flex;justify-content:space-between;align-items:center;font-size:14px;color:#718096;}
#slogan{font-weight:600;color:#4a5568;}
#signature{position:fixed;bottom:env(safe-area-inset-bottom,20px);right:20px;background:rgba(74,85,104,0.1);padding:12px 24px;border:1px solid #4a5568;border-radius:12px;font-family:monospace;box-shadow:0 4px 12px rgba(74,85,104,0.1);z-index:1000;max-width:200px;text-align:center;}
#title{font-size:16px;font-weight:700;color:#4a5568;}
#by{font-size:10px;color:#718096;margin-top:2px;}
</style>
</head>
<body>
<header>
<div id="logo">
<img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTIiIGN5PSIxMiIgcj0iMTIiIGZpbGw9IiM0QTU1NjgiLz4KPHBhdGggZD0iTTExIDZMMTMgOUwxMSAxMUw5IDlMMTAgNkwxMiA0TDE0IDZMMTIgOUwxNCAxMUwxMiAxM1oiIGZpbGw9IndoaXRlIi8+Cjwvc3ZnPgo=" alt="Logo">
<span id="logo-text">Visualgraal</span>
</div>
<select onchange="document.documentElement.lang=this.value">
<option value="fr">FR</option><option value="en">EN</option>
</select>
</header>

<div id="prompt-section">
<textarea id="prompt" placeholder="Un dragon dans un ciel violet au coucher du soleil..."></textarea>
<button id="generate">Générer l'image</button>
</div>

<div id="canvas-area">
<canvas id="canvas" width="900" height="600"></canvas>
</div>

<div id="tools">
<button class="active" onclick="tool='pencil'">Pinceau</button>
<button onclick="tool='eraser'">Gomme</button>
<button onclick="ctx.clearRect(0,0,canvas.width,canvas.height)">Nouveau</button>
<button onclick="download()">Exporter PNG</button>
</div>

<div id="signature">Visualgraal<br><small>by Jean-Luc Battini</small></div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let tool = 'pencil';
let drawing = false;

ctx.lineWidth = 25;
ctx.lineCap = 'round';
ctx.strokeStyle = '#4a5568';

['mousedown','touchstart'].forEach(ev => canvas.addEventListener(ev, e => { drawing = true; startPos(e); }));
['mousemove','touchmove'].forEach(ev => canvas.addEventListener(ev, e => { if(drawing) drawLine(e); }));
['mouseup','mouseleave','touchend','touchcancel'].forEach(ev => canvas.addEventListener(ev, () => drawing = false));

function startPos(e) {
e.preventDefault();
const rect = canvas.getBoundingClientRect();
const x = (e.clientX || e.touches[0].clientX) - rect.left;
const y = (e.clientY || e.touches[0].clientY) - rect.top;
ctx.beginPath();
ctx.moveTo(x, y);
}

function drawLine(e) {
e.preventDefault();
const rect = canvas.getBoundingClientRect();
const x = (e.clientX || e.touches[0].clientX) - rect.left;
const y = (e.clientY || e.touches[0].clientY) - rect.top;
if (tool === 'pencil') {
ctx.globalCompositeOperation = 'source-over';
ctx.lineTo(x, y);
ctx.stroke();
} else {
ctx.globalCompositeOperation = 'destination-out';
ctx.lineTo(x, y);
ctx.stroke();
}
}

function download() {
const a = document.createElement('a');
a.href = canvas.toDataURL();
a.download = 'visualgraal.png';
a.click();
}

// Génération locale instantanée
document.getElementById('generate').addEventListener('click', () => {
const grad = ctx.createLinearGradient(0,0,canvas.width,canvas.height);
grad.addColorStop(0, '#7c3aed');
grad.addColorStop(1, '#ec4899');
ctx.fillStyle = grad;
ctx.fillRect(0,0,canvas.width,canvas.height);
});
</script>
</body>
</html>
